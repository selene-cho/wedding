import { useEffect, useState } from 'react';
import classNames from 'classnames/bind';
import {
  parseISO,
  differenceInDays,
  differenceInHours,
  differenceInMinutes,
  differenceInSeconds,
  isBefore,
} from 'date-fns';

import Section from '@shared/Section';
import styles from './DdayCalculator.module.scss';

const cx = classNames.bind(styles);

const INITIALIZED_D_DAY = { days: 0, hours: 0, minutes: 0, seconds: 0 };

export default function DdayCalculator({ date, groomName, brideName }) {
  const weddingDay = parseISO(date);

  const [timeDiff, setTimeDiff] = useState(INITIALIZED_D_DAY);

  function calcTimeDiff() {
    const today = new Date();

    if (isBefore(weddingDay, today)) {
      setTimeDiff({ INITIALIZED_D_DAY });

      return;
    }

    const days = differenceInDays(weddingDay, today);
    const hours = differenceInHours(weddingDay, today) % 24;
    const minutes = differenceInMinutes(weddingDay, today) % 60;
    const seconds = differenceInSeconds(weddingDay, today) % 60;

    setTimeDiff({ days, hours, minutes, seconds });
  }

  useEffect(() => {
    calcTimeDiff();

    const ddayTimer = setInterval(() => {
      calcTimeDiff();
    }, 1000);

    return () => clearInterval(ddayTimer);
  }, [date]);

  return (
    <Section className={cx('container')}>
      <div>D-DAY</div>
      <IconWedding className={cx('icon-wedding')} />
      <div className={cx('wrap-dday')}>
        <div className={cx('wrap-txt')}>
          <span className={cx('txt-time')}>{timeDiff.days}</span>
          <span className={cx('txt-time_unit')}>일</span>
        </div>
        <div className={cx('wrap-txt')}>
          <div className={cx('txt-time')}>{timeDiff.hours}</div>
          <span className={cx('txt-time_unit')}>시간</span>
        </div>
        <div className={cx('wrap-txt')}>
          <div className={cx('txt-time')}>{timeDiff.minutes}</div>
          <span className={cx('txt-time_unit')}>분</span>
        </div>
        <div className={cx('wrap-txt')}>
          <div className={cx('txt-time')}>{timeDiff.seconds}</div>
          <span className={cx('txt-time_unit')}>초</span>
        </div>
      </div>
      <div className={cx('wrap-caption')}>
        <span className={cx('txt-name')}>{groomName}</span>
        <span className={cx('txt-heart')}>♥︎</span>
        <span className={cx('txt-name')}>{brideName}</span>의 결혼식이{' '}
        <span className={cx('txt-dday')}>{timeDiff.days}</span>일 남았습니다.
      </div>
    </Section>
  );
}

function IconWedding({ className }) {
  return (
    <svg className={className} viewBox="0 0 128 128">
      <g>
        <path d="M24.271,23.414a10.915,10.915,0,0,0,8.3,1.161,20.844,20.844,0,0,0,3.511,1.736,19.127,19.127,0,0,0,6.929,1.447,12.745,12.745,0,0,0,3.58-.5c1.307,5.158,6.393,8.52,11.359,11.8,1.932,1.276,3.93,2.595,5.713,4.014a.5.5,0,0,0,.623,0c1.783-1.419,3.781-2.738,5.713-4.014,4.92-3.249,9.961-6.577,11.323-11.663a12.826,12.826,0,0,0,3.062.365,19.187,19.187,0,0,0,6.932-1.443,20.5,20.5,0,0,0,3.513-1.736,10.912,10.912,0,0,0,8.3-1.161c7.035-4.224,5.869-12.559,5.857-12.643a.5.5,0,0,0-.989.148c.012.077,1.07,7.764-5.382,11.637a9.863,9.863,0,0,1-6.675,1.234c2.982-2.34,3.274-4.775,3.158-6.084a5.975,5.975,0,0,0-3.586-4.879,4.63,4.63,0,0,0-4.843.568,4.733,4.733,0,0,0-1.368,1.9,6.137,6.137,0,0,0,.014,5.164,7.823,7.823,0,0,0,4.249,3.706,20.721,20.721,0,0,1-2.614,1.217,15.614,15.614,0,0,1-9.424,1.026A12.62,12.62,0,0,0,81,20.485a7.787,7.787,0,0,0-7.781-5.339,10.5,10.5,0,0,0-9.238,6.35,10.492,10.492,0,0,0-9.222-6.35,7.842,7.842,0,0,0-7.8,5.359,12.642,12.642,0,0,0-.555,5.76c-2.876.862-6.216.573-9.946-.885a21.5,21.5,0,0,1-2.614-1.218,7.82,7.82,0,0,0,4.248-3.706,6.142,6.142,0,0,0,.016-5.163,4.747,4.747,0,0,0-1.372-1.9,4.636,4.636,0,0,0-4.852-.563,5.976,5.976,0,0,0-3.583,4.883c-.113,1.309.181,3.741,3.164,6.077a9.879,9.879,0,0,1-6.672-1.235C18.333,18.683,19.392,11,19.4,10.919a.5.5,0,0,0-.989-.148C18.4,10.855,17.236,19.19,24.271,23.414Zm65.952-3.392a5.17,5.17,0,0,1,.007-4.345,3.754,3.754,0,0,1,1.069-1.5A3.514,3.514,0,0,1,93.51,13.4a4.077,4.077,0,0,1,1.614.346,4.961,4.961,0,0,1,2.985,4.047c.181,2.039-1.041,4.055-3.444,5.7A7.116,7.116,0,0,1,90.223,20.022Zm-42.324.8a6.837,6.837,0,0,1,6.67-4.681l.168,0a9.571,9.571,0,0,1,8.765,6.91.5.5,0,0,0,.476.349h0a.5.5,0,0,0,.476-.349,9.587,9.587,0,0,1,8.781-6.911,6.835,6.835,0,0,1,6.815,4.66c2.711,8.624-3.755,12.893-10.6,17.412-1.84,1.215-3.738,2.469-5.473,3.822-1.736-1.353-3.634-2.607-5.474-3.822C51.661,33.7,45.2,29.429,47.9,20.825ZM29.291,17.8a4.962,4.962,0,0,1,2.982-4.051A4.105,4.105,0,0,1,33.9,13.4a3.519,3.519,0,0,1,2.211.776,3.747,3.747,0,0,1,1.072,1.5,5.175,5.175,0,0,1,.007,4.344,7.117,7.117,0,0,1-4.443,3.467C30.337,21.852,29.113,19.838,29.291,17.8Z" />
        <path d="M118.367,83.132a4.54,4.54,0,0,0-1.849-3.345,13.2,13.2,0,0,0-5.323-1.945c-2.633-.461-6.264-1.116-9.543-1.708l-.05-.009a.484.484,0,0,0-.115-.144A5.959,5.959,0,0,0,99,74.854v-2.68c2.982-.965,6.255-2.623,7.437-5.418a16.144,16.144,0,0,0,.634-2.3,5.756,5.756,0,0,0,3.469-3.8,4.784,4.784,0,0,0-.407-4.229,2.926,2.926,0,0,0-.319-.343A23.523,23.523,0,0,0,110.828,48h0a17.019,17.019,0,0,0-2.983-9.123c-3.067-4.409-7.91-6.645-14.395-6.645-16.027,0-20.294,12.418-20.336,12.544a.5.5,0,0,0,.475.656h.786a13.914,13.914,0,0,0,2.19,11.343,5.109,5.109,0,0,0-.181,3.866,5.751,5.751,0,0,0,3.474,3.805,16.436,16.436,0,0,0,.641,2.329c1.177,2.78,4.449,4.434,7.431,5.4V74.53a4.3,4.3,0,0,0-2.321,1.061,1.194,1.194,0,0,0-.34.542c-3.282.6-6.908,1.248-9.546,1.71a14.98,14.98,0,0,0-4.391,1.4l-.946-8.453-.057-.36c-2.606-16.526-10.777-23.559-17.354-26.55l.475-.8a.5.5,0,0,0-.343-.747l-3.5-.621-1.02-2.76a.5.5,0,0,0-.706-.267l-2.848,1.528-3.6-2.727a.5.5,0,0,0-.6,0l-3.614,2.727-2.837-1.528a.5.5,0,0,0-.706.265l-1.03,2.762-3.5.621a.5.5,0,0,0-.342.748l.5.831c-6.563,3.014-14.685,10.059-17.279,26.522L6.784,117.026a.5.5,0,0,0,.5.556H65.955a.49.49,0,0,0,.244.073h54.52a.5.5,0,0,0,.5-.542Zm-12.143,3.32a8.72,8.72,0,0,1-.409,6.451,47.768,47.768,0,0,1-10.821,14.673,1.311,1.311,0,0,1-1.036-.656v-3.45l5.327-20.063a16.318,16.318,0,0,0,2.184-5.221C103.372,79.861,104.971,82.629,106.224,86.452Zm-20.85-8.2a12.594,12.594,0,0,0,2.272,5.171l5.312,20.048v3.453a1.3,1.3,0,0,1-1.025.652A47.62,47.62,0,0,1,81.112,92.9a8.72,8.72,0,0,1-.408-6.453C81.949,82.667,83.519,79.92,85.374,78.251Zm5.362,3.22c0,.017,0,.035,0,.052a.49.49,0,0,0,.265.332L89.3,85.74l-.624-2.354C89.42,82.737,90.113,82.1,90.736,81.471Zm3.86-3.588a5.2,5.2,0,0,1,.625,3.147,7.376,7.376,0,0,1-3.547,0,5.175,5.175,0,0,1,.631-3.146Zm3.659,5.5-.634,2.391-1.727-3.925a.483.483,0,0,0,.26-.329c.005-.025,0-.051.008-.077C96.774,82.06,97.469,82.7,98.255,83.386Zm-8.55,3.9L91.99,82.1a8.4,8.4,0,0,0,1.468.146,8.209,8.209,0,0,0,1.454-.145l2.3,5.223-3.751,14.129Zm8.99-4.845a33.5,33.5,0,0,1-2.468-2.373,6.682,6.682,0,0,0-.9-2.937.5.5,0,0,0-.341-.227,10.041,10.041,0,0,1,2.545-1.223,5.356,5.356,0,0,1,3.138.934A13.335,13.335,0,0,1,98.7,82.445Zm10.887-22.087a4.873,4.873,0,0,1-2.3,2.9,44.568,44.568,0,0,0,.457-6.644,1.326,1.326,0,0,1,1.142.018.45.45,0,0,0,.043.027,1.612,1.612,0,0,1,.419.385A3.91,3.91,0,0,1,109.582,60.358ZM75.443,45.307l1.341-.536a.5.5,0,0,0-.371-.929l-1.482.593h-.6c1.108-2.489,5.93-11.2,19.12-11.2,5.462,0,9.7,1.67,12.594,4.964a16.1,16.1,0,0,1,3.817,9.662.483.483,0,0,0-.03.206,23.128,23.128,0,0,1-.9,7.518,2.3,2.3,0,0,0-1.193-.008c-.015-.82-.043-1.353-.048-1.433a.5.5,0,0,0-.281-.422,12.773,12.773,0,0,1-6.849-9.492.5.5,0,0,0-.914-.2c-3.75,5.773-11.2,9.376-19.919,9.638a.478.478,0,0,0-.1.022.462.462,0,0,0-.134,0,4.821,4.821,0,0,1-1.771.04.5.5,0,0,0-.239.971,4.3,4.3,0,0,0,.949.089,7.02,7.02,0,0,0,.786-.055c-.008.227-.016.5-.022.839a2.185,2.185,0,0,0-1.956.413A12.939,12.939,0,0,1,75.443,45.307Zm1.895,15.042a3.849,3.849,0,0,1,.243-3.3,1.278,1.278,0,0,1,1.6-.432,44.654,44.654,0,0,0,.458,6.645A4.875,4.875,0,0,1,77.338,60.349Zm4.09,6.061c-1.386-3.746-1.272-10.022-1.21-11.755,8.357-.364,15.555-3.725,19.583-9.1a13.76,13.76,0,0,0,6.9,8.936,46.884,46.884,0,0,1-.545,9.464.5.5,0,0,0-.022.109,15.214,15.214,0,0,1-.629,2.327c-1.081,2.555-4.3,4.074-7.164,4.949a.458.458,0,0,0-.049.015c-1.021.31-2,.539-2.811.7a10.236,10.236,0,0,1-4.037,0c-.813-.162-1.787-.391-2.806-.7a.444.444,0,0,0-.062-.019C85.712,70.461,82.5,68.947,81.428,66.41Zm9.82,6.625a11.255,11.255,0,0,0,4.429,0c.686-.137,1.481-.322,2.321-.559v2.245c-.162-.011-.318-.036-.485-.036a.625.625,0,0,0-.194.02,11.956,11.956,0,0,0-3.86,2.059,11.693,11.693,0,0,0-3.8-2.042,3.076,3.076,0,0,0-.729-.186V72.477C89.768,72.713,90.563,72.9,91.248,73.035Zm-5,3.331a3.169,3.169,0,0,1,3.081-.7,9.918,9.918,0,0,1,2.6,1.239.5.5,0,0,0-.355.229,6.623,6.623,0,0,0-.911,2.969c-.714.763-1.536,1.557-2.463,2.369a10.061,10.061,0,0,1-1.955-6.078ZM69.34,70.587,70.4,80.019a.5.5,0,0,0,.022.195L74.5,116.582H66.476c-.008,0-.014-.012-.022-.016a124.676,124.676,0,0,1-3.9-20.522c-1.239-12.026-6.5-12.4-10.783-12.7-3.765-.263-6.63-1.038-6.441-7.955a10.67,10.67,0,0,0,7.008-6.82,5.743,5.743,0,0,0,.92-.131,9.929,9.929,0,0,1-.961,2.08c-3.388,5.506-.712,9.325-.6,9.484a.5.5,0,0,0,.4.207.5.5,0,0,0,.407-.791c-.1-.139-2.387-3.462.636-8.376a11.13,11.13,0,0,0,1.29-3.019A5.347,5.347,0,0,0,56.9,65.484c.827-1.731.8-3.774-.058-4.859a2.591,2.591,0,0,0-.446-.438c.551-3.238.612-7.745-1.989-11.452A12.411,12.411,0,0,0,51.718,46l.74-1.248C58.825,47.614,66.789,54.412,69.34,70.587ZM28.669,49.31c2.125-3.028,5.85-5,11.071-5.872a8.541,8.541,0,0,1,2.777,0c5.221.868,8.946,2.844,11.07,5.872,2.343,3.339,2.344,7.438,1.863,10.466a2.617,2.617,0,0,0-1.508.264c-.035-.093-.069-.184-.1-.255,0-.039,0-.074.005-.112a.5.5,0,0,0-.411-.5c-5.53-1-9.406-4.372-11.85-10.316a.52.52,0,0,0-.924,0c-2.444,5.944-6.32,9.319-11.85,10.316-.015,0-.028.012-.043.016a.552.552,0,0,0-.077.029.531.531,0,0,0-.086.052.507.507,0,0,0-.061.052.526.526,0,0,0-.066.089c-.009.015-.023.026-.031.042-.019.04-.108.242-.225.553a2.562,2.562,0,0,0-1.418-.222C26.326,56.752,26.325,52.651,28.669,49.31ZM53.637,62.892a12.176,12.176,0,0,1-.078,4.437,4.493,4.493,0,0,1-.858.2A23.954,23.954,0,0,0,53.637,62.892Zm.617-1.9c1.128-.584,1.624.026,1.8.253A4,4,0,0,1,56,65.053,4.669,4.669,0,0,1,54.7,66.7,13.867,13.867,0,0,0,54.254,60.993ZM26.2,61.245a1.232,1.232,0,0,1,1.708-.285,13.914,13.914,0,0,0-.468,5.641,4.707,4.707,0,0,1-1.173-1.533A4.016,4.016,0,0,1,26.2,61.245Zm2.378,1.27a24.44,24.44,0,0,0,.975,5.019,4.377,4.377,0,0,1-.968-.249A12.377,12.377,0,0,1,28.579,62.515Zm2.143,5.448a.45.45,0,0,0-.026-.081,25.542,25.542,0,0,1-1.281-7.809c5.333-1.087,9.176-4.294,11.712-9.779,2.536,5.485,6.379,8.692,11.712,9.779a25.526,25.526,0,0,1-1.284,7.818.432.432,0,0,0-.016.051c-1.715,4.7-5.126,6.98-10.4,7.063C35.854,74.922,32.44,72.649,30.722,67.963Zm10.413,8.042a16.026,16.026,0,0,0,3.2-.362c-.106,7.513,3.572,8.435,7.418,8.7,4.257.3,8.659.609,9.812,11.8.422,4.13,1.05,7.966,1.686,11.207l-8.353,4.966a20.84,20.84,0,0,0-2.567-5.406c1.638-3,2.418-7.04,2.45-12.666.007-1.146-.016-2.381-.07-3.775a.5.5,0,0,0-.369-.464c-5.2-1.406-9.526-1.065-13.211,1.041-3.686-2.106-8.012-2.445-13.211-1.041a.5.5,0,0,0-.37.464c-.053,1.394-.076,2.629-.07,3.775.033,5.627.813,9.665,2.45,12.666a20.843,20.843,0,0,0-2.577,5.438l-8.455-4.411c.675-3.359,1.355-7.413,1.8-11.794,1.143-11.19,5.55-11.5,9.858-11.8,3.8-.266,7.478-1.19,7.372-8.7A16.073,16.073,0,0,0,41.135,76.005ZM55.961,116.5c-.228-1.141-.484-2.2-.769-3.19l8.264-4.913c.807,3.947,1.59,6.872,1.938,8.1ZM30.7,107.571a24.771,24.771,0,0,0,10.429,2.4,24.771,24.771,0,0,0,10.429-2.4,24.387,24.387,0,0,1,3.39,8.923H27.308A24.352,24.352,0,0,1,30.7,107.571ZM28.489,92.488c.01-.515.023-1.045.043-1.608,4.885-1.252,8.924-.867,12.338,1.177a.5.5,0,0,0,.514,0c3.413-2.043,7.453-2.429,12.338-1.177.019.563.033,1.092.042,1.607,0,.142,0,.278,0,.417,0,.219,0,.427,0,.638-3.623-1.185-9.383-2.056-12.646,2.668a8.41,8.41,0,0,0-7.323-3.6,17.523,17.523,0,0,0-5.324.935c0-.211,0-.419,0-.638C28.486,92.766,28.487,92.63,28.489,92.488ZM40.694,97.4a.5.5,0,0,0,.866,0c2.9-5.032,8.752-3.986,12.209-2.8-.063,5.345-.826,9.161-2.395,11.958a23.032,23.032,0,0,1-20.495,0c-1.568-2.8-2.331-6.613-2.395-11.958C31.941,93.411,37.793,92.365,40.694,97.4ZM18.685,108.959l8.371,4.367c-.283.984-.537,2.036-.763,3.169H16.864C17.194,115.323,17.92,112.62,18.685,108.959ZM33.1,42.647a.5.5,0,0,0,.381-.317l.93-2.493,2.614,1.409a.5.5,0,0,0,.539-.042l3.568-2.693L44.686,41.2a.5.5,0,0,0,.539.042l2.624-1.409.92,2.491a.5.5,0,0,0,.382.319l3.069.544L50.9,45.414a21.29,21.29,0,0,0-8.223-2.962,9.5,9.5,0,0,0-3.1,0,21.289,21.289,0,0,0-8.224,2.962l-1.325-2.223ZM12.945,70.953,13,70.59c2.539-16.116,10.455-22.925,16.809-25.808L30.538,46a12.388,12.388,0,0,0-2.687,2.736c-2.6,3.707-2.54,8.213-1.988,11.452a2.561,2.561,0,0,0-.447.438c-.862,1.092-.883,3.143-.05,4.876a5.36,5.36,0,0,0,2.329,2.46A11.135,11.135,0,0,0,29,71.044c3.023,4.914.735,8.237.636,8.376a.5.5,0,0,0,.812.584c.115-.159,2.791-3.978-.6-9.484a9.936,9.936,0,0,1-.968-2.1,5.724,5.724,0,0,0,1.028.153,10.672,10.672,0,0,0,7.01,6.818c.189,6.917-2.677,7.693-6.487,7.96-4.236.3-9.508.667-10.737,12.694a124.71,124.71,0,0,1-3.9,20.538H7.84Zm97.882,45.7V93.7a.5.5,0,0,0-1,0v22.959H77.1V93.7a.5.5,0,0,0-1,0v22.959h-.581L71.452,80.322A13.221,13.221,0,0,1,75.9,78.828c2.547-.447,6.015-1.065,9.207-1.648-2.163,1.753-3.964,4.753-5.348,8.958a9.718,9.718,0,0,0,.452,7.189A48.674,48.674,0,0,0,91.43,108.473a.5.5,0,0,0,.339.132l.056,0a2.647,2.647,0,0,0,1.636-.721,2.669,2.669,0,0,0,1.642.721.525.525,0,0,0,.056,0,.5.5,0,0,0,.339-.133,48.82,48.82,0,0,0,11.224-15.145,9.725,9.725,0,0,0,.452-7.188c-1.374-4.19-3.177-7.189-5.355-8.958,3.189.575,6.66,1.2,9.2,1.647a12.4,12.4,0,0,1,4.917,1.774,3.545,3.545,0,0,1,1.432,2.615l2.8,33.438Z" />
        <path d="M93.453,66.97A4.878,4.878,0,0,0,98.4,63.158a.5.5,0,1,0-.96-.281,4.114,4.114,0,0,1-7.971,0,.5.5,0,1,0-.96.281A4.879,4.879,0,0,0,93.453,66.97Z" />
        <path d="M89.065,55.992c0-.956-.5-1.731-1.113-1.731s-1.112.775-1.112,1.731.5,1.73,1.112,1.73S89.065,56.947,89.065,55.992Z" />
        <path d="M98.953,57.722c.614,0,1.112-.775,1.112-1.73s-.5-1.731-1.112-1.731-1.112.775-1.112,1.731S98.339,57.722,98.953,57.722Z" />
        <path d="M93.453,61.716a1.8,1.8,0,0,0,1.8-1.8.5.5,0,0,0-1,0,.8.8,0,1,1-1.6,0,.5.5,0,0,0-1,0A1.8,1.8,0,0,0,93.453,61.716Z" />
        <path d="M36.137,61.772c.558,0,1.009-.7,1.009-1.57s-.451-1.569-1.009-1.569-1.009.7-1.009,1.569S35.58,61.772,36.137,61.772Z" />
        <path d="M46.116,61.772c.557,0,1.009-.7,1.009-1.57s-.452-1.569-1.009-1.569-1.009.7-1.009,1.569S45.559,61.772,46.116,61.772Z" />
        <path d="M41.118,65.654a1.725,1.725,0,0,0,1.723-1.723.5.5,0,0,0-1,0,.724.724,0,0,1-1.447,0,.5.5,0,0,0-1,0A1.725,1.725,0,0,0,41.118,65.654Z" />
        <path d="M36.773,66.371a.5.5,0,0,0-.34.62,4.844,4.844,0,0,0,9.369,0,.5.5,0,0,0-.96-.281,3.845,3.845,0,0,1-7.449,0A.5.5,0,0,0,36.773,66.371Z" />
      </g>
    </svg>
  );
}
